<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤ë§ˆíŠ¸í™ˆ 1ì¡° Control Panel</title>
    <style>
        body { font-family: 'Pretendard', sans-serif; text-align: center; background: #eef2f3; margin: 0; padding: 20px; }
        .container { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; max-width: 800px; margin: 0 auto; }
        
        .card { background: white; padding: 20px; width: 100%; max-width: 320px; border-radius: 15px; box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
        h2 { margin: 0 0 20px 0; color: #333; font-size: 22px; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px; }
        
        .env-box { display: flex; justify-content: space-around; margin-bottom: 20px; }
        .data-val { font-size: 32px; font-weight: bold; color: #2c3e50; }
        .label { font-size: 14px; color: #7f8c8d; display: block; }
        
        .btn { width: 100%; padding: 15px; margin: 5px 0; border: none; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: space-between; }
        .btn:active { transform: scale(0.98); }
        
        .btn-main { background: #3498db; color: white; }
        .btn-device { background: #f8f9fa; color: #333; border: 1px solid #ddd; }
        
        /* ìƒíƒœë³„ ìƒ‰ìƒ */
        .active-blue { background: #e3f2fd; color: #2196F3; border-color: #2196F3; } /* ì—ì–´ì»¨ */
        .active-red { background: #ffebee; color: #f44336; border-color: #f44336; }  /* íˆí„° */
        .active-yellow { background: #fffde7; color: #fbc02d; border-color: #fbc02d; } /* ì „ë“± */
        .active-green { background: #e8f5e9; color: #4caf50; border-color: #4caf50; } /* ê°€ìŠµê¸° [NEW] */
        
        .disabled { opacity: 0.5; pointer-events: none; }
    </style>
</head>
<body>
    <h1 style="color:#2c3e50;">ğŸ  1ì¡° ìŠ¤ë§ˆíŠ¸í™ˆ ì‹œìŠ¤í…œ</h1>

    <div class="container">
        <div class="card">
            <h2>ğŸŒ¡ï¸ ì‹¤ë‚´ í™˜ê²½</h2>
            <div class="env-box">
                <div>
                    <span class="label">ì˜¨ë„</span>
                    <span class="data-val" id="temp">--</span>Â°C
                </div>
                <div>
                    <span class="label">ìŠµë„</span>
                    <span class="data-val" id="humid">--</span>%
                </div>
            </div>
            <div style="text-align: left; background: #fafafa; padding: 10px; border-radius: 10px;">
                <span class="label">í˜„ì¬ ëª¨ë“œ</span>
                <strong id="mode_text" style="font-size: 18px; color: #2ecc71;">AUTO</strong>
            </div>
            <button class="btn btn-main" style="margin-top: 15px;" onclick="sendControl('auto_toggle')">
                ğŸ”„ ìë™/ìˆ˜ë™ ëª¨ë“œ ì „í™˜
            </button>
        </div>

        <div class="card">
            <h2>ğŸ’¡ ê¸°ê¸° ì œì–´</h2>
            
            <button id="btn-lamp" class="btn btn-device" onclick="sendControl('lamp_toggle')">
                <span>ğŸ’¡ ê±°ì‹¤ ì „ë“±</span> <span id="lamp-status">OFF</span>
            </button>
            
            <hr style="border: 0; border-top: 1px solid #eee; margin: 15px 0;">

            <div id="hvac-controls">
                <button id="btn-fan" class="btn btn-device" onclick="sendControl('fan_toggle')">
                    <span>â„ï¸ ì—ì–´ì»¨</span> <span id="fan-status">OFF</span>
                </button>
                
                <button id="btn-heater" class="btn btn-device" onclick="sendControl('heater_toggle')">
                    <span>â™¨ï¸ ë‚œë°©ê¸°</span> <span id="heater-status">OFF</span>
                </button>

                <button id="btn-humid" class="btn btn-device" onclick="sendControl('humidifier_toggle')">
                    <span>ğŸ’§ ê°€ìŠµê¸°</span> <span id="humidifier-status">OFF</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        function updateUI() {
            fetch('/status').then(res => res.json()).then(data => {
                // 1. ì˜¨ìŠµë„
                document.getElementById('temp').innerText = data.temp;
                document.getElementById('humid').innerText = data.humid;
                
                // 2. ëª¨ë“œ UI
                const modeText = document.getElementById('mode_text');
                const hvacDiv = document.getElementById('hvac-controls');
                
                if(data.mode === "AUTO") {
                    modeText.innerText = "ğŸ¤– ìë™ ì œì–´ ì¤‘";
                    modeText.style.color = "#2ecc71";
                    hvacDiv.classList.add('disabled'); // ë²„íŠ¼ ì ê¸ˆ
                } else {
                    modeText.innerText = "âœ‹ ìˆ˜ë™ ì œì–´ ì¤‘";
                    modeText.style.color = "#f39c12";
                    hvacDiv.classList.remove('disabled'); // ë²„íŠ¼ í’€ë¦¼
                }

                // 3. ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
                setBtnState('btn-lamp', 'lamp-status', data.lamp, 'active-yellow');
                setBtnState('btn-fan', 'fan-status', data.fan, 'active-blue');
                setBtnState('btn-heater', 'heater-status', data.heater, 'active-red');
                setBtnState('btn-humid', 'humidifier-status', data.humidifier, 'active-green'); // [NEW]
            });
        }

        function setBtnState(btnId, textId, isActive, activeClass) {
            const btn = document.getElementById(btnId);
            const txt = document.getElementById(textId);
            
            if(isActive) {
                btn.classList.add(activeClass);
                txt.innerText = "ON";
            } else {
                btn.classList.remove(activeClass);
                txt.innerText = "OFF";
            }
        }

        function sendControl(act) {
            const form = new FormData();
            form.append('action', act);
            fetch('/control', { method: 'POST', body: form }).then(updateUI);
        }

        setInterval(updateUI, 1000); // 1ì´ˆë§ˆë‹¤ ê°±ì‹ 
        updateUI();
    </script>
</body>
</html>